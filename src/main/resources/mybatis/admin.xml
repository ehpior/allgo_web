<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.allgo.web.dao.AdminDaoMapper">

	<select id="adminLoginCheck" parameterType="com.allgo.web.dto.AdminDto" resultType="int">
		select count(*)
		from admin
		where id = #{id}
			and password = #{password}
	</select>
	
	<select id="stockInfoInit" resultType="com.allgo.web.vo.stock_list">
		SELECT a.*, b.price as price
		FROM STOCK_LIST a
			left JOIN STOCK_CHEG b ON b.code = a.code AND b.date = (SELECT MAX(DATE) FROM STOCK_CHEG)
		ORDER BY a.INDEX asc
	</select>
	
	<select id="getStockCnt">
		SELECT count(1)
		FROM STOCK_LIST
	</select>
	
	<select id="getRealCheg" parameterType="com.allgo.web.dto.SearchForm" resultType="com.allgo.web.packet.RealCheg">
		SELECT a.index, b.*
		FROM STOCK_LIST a
			left JOIN STOCK_CHEG b ON b.code = a.code AND b.date = (SELECT MAX(DATE) FROM STOCK_CHEG)
		ORDER BY a.INDEX asc
		limit #{startIndex}, #{rowsPerPage}
	</select>
	
	<select id="getRealProgram" parameterType="com.allgo.web.dto.SearchForm" resultType="com.allgo.web.packet.RealProgram">
		SELECT a.index, a.code, b.date, b.sell_volume, b.sell_amount, b.buy_volume, 
			b.buy_amount, b.net_buy_volume, b.net_buy_amount, b.market, b.ticker
		FROM STOCK_LIST a
			left JOIN STOCK_PROGRAM b ON b.code = a.code AND b.date = (SELECT MAX(DATE) FROM STOCK_PROGRAM)
		ORDER BY a.INDEX ASC
		limit #{startIndex}, #{rowsPerPage}
	</select>
	
	<select id="getAg_score" parameterType="com.allgo.web.dto.SearchForm" resultType="com.allgo.web.vo.ag_score">
		SELECT a.index, a.code, b.*
		FROM STOCK_LIST a
			left JOIN AG_SCORE b ON b.code = a.code AND b.date = (SELECT MAX(DATE) FROM AG_SCORE)
		ORDER BY b.date desc, b.score desc
		limit #{startIndex}, #{rowsPerPage}
	</select>
	
</mapper>